<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>hls-peerify</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<!--<script src="../dist/hls-peerify.js"></script>-->
<script src="../hls-peerify.js"></script>
<!--<script src="../dist/hls-peerify-vod.min.js"></script>-->
<body>
<video id="video" controls></video>
<script>

    console.log(JSON.stringify(HlsPeerify.uaParserResult, null, 2));
    console.log('hls.js version: ' + Hls.version);
    console.log('p2p plugin version: ' + HlsPeerify.version);
    if(Hls.isSupported()) {
        var video = document.getElementById('video');

        var hlsjsConfig = {

            maxBufferSize: 0,
//            maxBufferLength: 30,
            liveSyncDuration: 60,
//            fragLoadingTimeOut: 4000,              // used by fragment-loader
        };
        var p2pConfig = {
            key: 'free',
//            engine: 'bt',

            logLevel: 'debug',
            logUploadLevel: 'none',
        };

        var hls = new Hls(hlsjsConfig);

        var p2pPlugin = new HlsPeerify(hls, p2pConfig);

        hls.loadSource('https://video-dev.github.io/streams/x36xhzz/x36xhzz.m3u8');
//        hls.loadSource('https://video-dev.github.io/streams/test_001/stream.m3u8?a=123');
//        hls.loadSource('https://moeplayer.b0.upaiyun.com/dplayer/hls/hikarunara.m3u8');
//        hls.loadSource('http://wowza.peer5.com/live/smil:bbb_abr.smil/chunklist_w794046364_b2204000.m3u8');
//        hls.loadSource('http://120.79.51.249:8080/hls/stream.m3u8');
//        hls.loadSource('http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8');
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED,function(event, data) {

            hls.loadLevel = 0;
            video.play();
        });

        hls.on(Hls.Events.FRAG_LOADED, function (e, data) {
            var frag = data.frag;

//            console.warn(`frag ${JSON.stringify(frag)}`);
        });
    }
</script>
</body>
</html>