<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>hls-peerify</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<!--<script src="../dist/hls-peerify.js"></script>-->
<script src="../hls-peerify.js"></script>
<body>
<video id="video" controls></video>
<script>

    console.log(JSON.stringify(HlsPeerify.uaParserResult, null, 2));
    console.log('hls.js version: ' + Hls.version);
    console.log('p2p plugin version: ' + HlsPeerify.version);
    if(Hls.isSupported()) {
        var video = document.getElementById('video');

        var hlsjsConfig = {

            maxBufferSize: 0,
            maxBufferLength: 30,
            liveSyncDuration: 30,
            fragLoadingTimeOut: 4000,              // used by fragment-loader
        };

        var p2pConfig = {wsAddr: 'ws://127.0.0.1:8080/ws?key=free', reportInterval: 3600};
//        var p2pConfig = {reportInterval: 3600};

        var hls = new Hls(hlsjsConfig);

        var peerify = new HlsPeerify(hls, p2pConfig);

        hls.loadSource('https://video-dev.github.io/streams/x36xhzz/x36xhzz.m3u8');
//        hls.loadSource('https://video-dev.github.io/streams/test_001/stream.m3u8?a=123');
//        hls.loadSource('https://moeplayer.b0.upaiyun.com/dplayer/hls/hikarunara.m3u8');
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED,function(event, data) {

            hls.loadLevel = 0;
            video.play();
        });

        hls.on(Hls.Events.ERROR, function (event, data) {
            var errorType = data.type;
            var errorDetails = data.details;
            var errorFatal = data.fatal;
            console.warn('error details:'+errorDetails);
//      switch(data.details) {
//        case hls.ErrorDetails.FRAG_LOAD_ERROR:
//          // ....
//          break;
//        default:
//          break;
//      }
        });


    }
</script>
</body>
</html>